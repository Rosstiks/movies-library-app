(this.webpackJsonptodo=this.webpackJsonptodo||[]).push([[0],{131:function(e,t,a){},133:function(e,t,a){},136:function(e,t,a){},137:function(e,t,a){},138:function(e,t,a){},208:function(e,t,a){},214:function(e,t,a){},215:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(36),c=a.n(s),i=(a(130),a(131),a(1)),o=a(18),u=a(9),l=a(24),h=a.n(l),d=a(40),v=a(13),p=a(14),g=a(16),f=a(15),j=a(222),m=(a(133),a(220)),b=a.p+"static/media/no_image_poster.68ae3506.png",O=function e(){var t=this;Object(v.a)(this,e),this._apiKey="api_key=b7473b579abba0475a9336164324a2c1",this._apiBase="https://api.themoviedb.org/3",this._imageBase="https://image.tmdb.org/t/p/w500",this.requestFromDB=function(){var e=Object(d.a)(h.a.mark((function e(a){var r,n,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(t._apiBase).concat(a),e.next=3,fetch(r);case 3:return n=e.sent,e.next=6,n.json();case 6:return s=e.sent,e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createGuestSession=Object(d.a)(h.a.mark((function e(){var a,r,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(t._apiBase,"/authentication/guest_session/new?").concat(t._apiKey),e.next=3,fetch(a);case 3:return r=e.sent,e.next=6,r.json();case 6:return n=e.sent,e.abrupt("return",n.guest_session_id);case 8:case"end":return e.stop()}}),e)}))),this.rateMovie=function(){var e=Object(d.a)(h.a.mark((function e(a,r,n){var s,c,i,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="".concat(t._apiBase,"/movie/").concat(a,"/rating?").concat(t._apiKey,"&guest_session_id=").concat(n),c={method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({value:r})},e.next=4,fetch(s,c);case 4:return i=e.sent,e.next=7,i.json();case 7:return o=e.sent,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),this.searchMovies=function(){var e=Object(d.a)(h.a.mark((function e(a,r,n,s){var c,i,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n?"/guest_session/".concat(s,"/rated/movies?").concat(t._apiKey,"&page=").concat(a):"/search/movie?".concat(t._apiKey,"&query=").concat(r,"&page=").concat(a),e.next=3,t.requestFromDB(c);case 3:return i=e.sent,o=i.results.map((function(e){return t.createDataMovie(e)})),e.abrupt("return",{data:o,currentPage:i.page,totalResults:i.total_results});case 6:case"end":return e.stop()}}),e)})));return function(t,a,r,n){return e.apply(this,arguments)}}(),this.getGenresList=Object(d.a)(h.a.mark((function e(){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/genre/movie/list?".concat(t._apiKey),e.next=3,t.requestFromDB(a);case 3:return r=e.sent,e.abrupt("return",r.genres.reduce((function(e,t){return e[t.id]=t.name,e}),{}));case 5:case"end":return e.stop()}}),e)}))),this.createDataMovie=function(e){var a;try{a=Object(m.a)(new Date(e.release_date),"MMM d, y")}catch(n){a="No date info"}var r=e.poster_path?"".concat(t._imageBase).concat(e.poster_path):b;return{id:e.id,title:e.title,overview:e.overview,date:a,poster:r,genresIds:e.genre_ids,globalRate:e.vote_average,userRate:e.rating||0}}},R=a(47),x=a.n(R),_=a(227),S=a(221),y=a(226),w=(a(136),n.a.createContext()),P=w.Provider,D=w.Consumer,k=(a(137),a(138),a(2)),N=a.n(k),B=a(8);function I(e){var t=e.poster,a=e.globalRate,r=e.title,n=e.date,s=e.genresIds,c=e.genresList,i=s.map((function(e){return Object(B.jsx)("span",{className:"movie-item__genres-item",children:c[e]},e)})),o=N()({"movie-item__vote-container--low":a<3,"movie-item__vote-container--pre-intermediate":a>=3&&a<5,"movie-item__vote-container--intermediate":a>=5&&a<7});return Object(B.jsxs)("header",{className:"movie-item__header",children:[Object(B.jsx)("img",{className:"movie-item__poster",src:t,alt:"Movie poster"}),Object(B.jsxs)("div",{className:"movie-item__header-content",children:[Object(B.jsx)("div",{className:"movie-item__vote-container ".concat(o),children:Object(B.jsx)("span",{className:"movie-item__vote",children:a})}),Object(B.jsx)("h3",{className:"movie-item__title",children:r}),Object(B.jsx)("div",{className:"movie-item__date",children:n}),Object(B.jsx)("div",{className:"movie-item__genres-container",children:i})]})]})}I.defaultProps={globalRate:0,genresList:{}};var M=I,C=a(225);function q(e){var t=e.userRate,a=e.changeRate;return Object(B.jsx)(C.a,{onChange:function(e){return a(e)},defaultValue:t,allowHalf:!0,count:10,style:{fontSize:"1.2em",verticalAlign:"middle",lineHeight:"46px"}})}q.defaultProps={userRate:0};var E=q;var L=["overview","userRate","id"],K=function(e){Object(g.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(v.a)(this,a);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).movieDBService=new O,e.changeRate=function(t){var a=e.movieDBService.rateMovie,r=e.props,n=r.id,s=r.sessionID,c=r.refreshRated;a(n,t,s).then((function(){setTimeout((function(){return c()}),1e3)}))},e}return Object(p.a)(a,[{key:"componentDidMount",value:function(){!function(e){for(var t=document.getElementById(e);t.scrollHeight>t.clientHeight;){var a=t.textContent.lastIndexOf(" ");t.textContent="".concat(t.textContent.slice(0,a),"...")}}(this.props.id)}},{key:"render",value:function(){var e=this,t=this.props,a=t.overview,r=t.userRate,n=t.id,s=Object(u.a)(t,L);return Object(B.jsxs)("div",{className:"movie-item",children:[Object(B.jsx)(D,{children:function(e){return Object(B.jsx)(M,Object(i.a)(Object(i.a)({},s),{},{genresList:e}))}}),Object(B.jsx)("p",{id:n,className:"movie-item__overview",children:a}),Object(B.jsx)("footer",{className:"movie-item__footer",children:Object(B.jsx)(E,{userRate:r,changeRate:function(t){return e.changeRate(t)}})})]})}}]),a}(n.a.Component);K.defaultProps={userRate:0,overview:"Overview not found",sessionID:null};var T=function(e){Object(g.a)(a,e);var t=Object(f.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(p.a)(a,[{key:"createMovieList",value:function(e){var t=this.props,a=t.sessionID,r=t.refreshRated;return e.map((function(e){var t=e.id;return Object(B.jsx)(_.a,{xs:{span:24},lg:{span:12},children:Object(B.jsx)(K,Object(i.a)({sessionID:a,refreshRated:r},e))},t)}))}},{key:"render",value:function(){var e=this.props,t=e.data,a=e.changePage,r=e.currentPage,n=e.currentSearch,s=e.totalResults,c=this.createMovieList(t),i=Object(B.jsx)(S.a,{current:r,total:s,onChange:function(e){return a(e,n)},pageSize:20,showSizeChanger:!1}),o=c.length?i:null;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(y.a,{gutter:[36,36],children:c}),Object(B.jsx)("div",{className:"movie-list__pagination-container",children:o})]})}}]),a}(n.a.Component);T.defaultProps={currentPage:0,currentSearch:"",sessionID:null};var V=T,A=a(224);var F=function(e){var t=e.type,a={noResult:"No matches",error:"Bad news",noRated:"It's empty here for now"}[t],r={noResult:"Sorry, no results were found. Try to change your request.",error:"Sorry, something went wrong. Try to reload the page and repeat.",noRated:"Rate movies to add to the list"}[t];return Object(B.jsx)(A.a,{message:a,description:r,showIcon:!0,type:"info"})},z=a(219);a(208);var G=function(){return Object(B.jsx)(z.a,{className:"load-spinner",size:"large"})},H=["loading","loadingError","currentSearch","totalResults","changePage","refreshRated","search"];function J(e){var t=e.loading,a=e.loadingError,r=e.currentSearch,n=e.totalResults,s=e.changePage,c=e.refreshRated,o=e.search,l=Object(u.a)(e,H),h=Object(B.jsx)(V,Object(i.a)({changePage:s,currentSearch:r,totalResults:n,refreshRated:c},l)),d=null;o&&(d=n||t||!r?null:Object(B.jsx)(F,{type:"noResult"}));var v=a?Object(B.jsx)(F,{type:"error"}):null,p=t?Object(B.jsx)(G,{}):null,g=t||a?null:h;return Object(B.jsxs)(B.Fragment,{children:[d,v,p,g]})}J.propTypes={loading:x.a.bool.isRequired,loadingError:x.a.bool.isRequired,currentSearch:x.a.string,totalResults:x.a.number.isRequired,changePage:x.a.func.isRequired,refreshRated:x.a.func.isRequired,search:x.a.bool},J.defaultProps={currentSearch:"",search:!1};var Q=J,U=a(223),W=a(117),X=a.n(W),Y=(a(214),function(e){Object(g.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(v.a)(this,a);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).state={inputValue:null},e.newRequest=X()((function(t){return e.props.newSearch(1,t)}),400),e.changeInputValue=function(t){e.setState({inputValue:t.target.value}),e.newRequest(t.target.value)},e}return Object(p.a)(a,[{key:"render",value:function(){var e=this.state.inputValue;return Object(B.jsx)("header",{className:"header",children:Object(B.jsx)(U.a,{onChange:this.changeInputValue,placeholder:"Type to search...",value:e})})}}]),a}(n.a.Component)),Z=Y,$=["data","ratedData","currentPageSearch","currentPageRated","totalResultsSearch","totalResultsRated"],ee=function(e){Object(g.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(v.a)(this,a);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).movieDBService=new O,e.state={data:[],ratedData:[],currentSearch:"",currentPageSearch:1,currentPageRated:1,totalResultsSearch:0,totalResultsRated:0,loading:!1,loadingError:!1,sessionID:null},e.getData=function(){var t=Object(d.a)(h.a.mark((function t(a,r,n,s){var c,i,o,u,l;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==r||n){t.next=3;break}return e.setState({data:[],currentSearch:"",totalResultsSearch:0,loading:!1}),t.abrupt("return");case 3:return t.prev=3,c=e.movieDBService.searchMovies,e.setState({loading:!0}),t.next=8,c(a,r,n,s);case 8:i=t.sent,o=i.data,u=i.currentPage,l=i.totalResults,e.setState((function(e){return{data:n?e.data:o,ratedData:n?o:e.ratedData,loading:!1,currentSearch:n?e.currentSearch:r,currentPageSearch:n?e.currentPageSearch:u,currentPageRated:n?u:e.currentPageRated,totalResultsSearch:n?e.totalResultsSearch:l}})),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(3),e.setState({loadingError:!0,loading:!1});case 16:case"end":return t.stop()}}),t,null,[[3,13]])})));return function(e,a,r,n){return t.apply(this,arguments)}}(),e.refreshRated=Object(d.a)(h.a.mark((function t(){var a,r,n,s,c;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.movieDBService.searchMovies,r=e.state,n=r.sessionID,s=r.currentPageRated,t.next=4,a(s,null,!0,n);case 4:c=t.sent,e.setState({ratedData:c.data,totalResultsRated:c.totalResults});case 6:case"end":return t.stop()}}),t)}))),e.changePageSearch=function(t){var a=e.state.currentSearch;e.getData(t,a)},e.changePageRated=function(t){var a=e.state.sessionID;e.getData(t,null,!0,a)},e}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.movieDBService,a=t.createGuestSession,r=t.getGenresList;a().then((function(t){return e.setState({sessionID:t})})),r().then((function(t){e.genresList=t}))}},{key:"render",value:function(){var e=j.a.TabPane,t=this.state,a=t.data,r=t.ratedData,n=t.currentPageSearch,s=t.currentPageRated,c=t.totalResultsSearch,l=t.totalResultsRated,h=Object(u.a)(t,$),d=Object(o.a)(a);return d.forEach((function(e){r.forEach((function(t){e.id===t.id&&(e.userRate=t.userRate)}))})),Object(B.jsx)(P,{value:this.genresList,children:Object(B.jsx)("div",{className:"container",children:Object(B.jsxs)(j.a,{defaultActiveKey:"search",children:[Object(B.jsxs)(e,{tab:"Search",children:[Object(B.jsx)(Z,{newSearch:this.getData}),Object(B.jsx)(Q,Object(i.a)({search:!0,refreshRated:this.refreshRated,data:d,totalResults:c,currentPage:n,changePage:this.changePageSearch},h))]},"search"),Object(B.jsx)(e,{tab:"Rated",children:Object(B.jsx)(Q,Object(i.a)({refreshRated:this.refreshRated,data:r,totalResults:l,currentPage:s,changePage:this.changePageRated},h))},"rated")]})})})}}]),a}(n.a.Component),te=ee;c.a.render(Object(B.jsx)(te,{}),document.getElementById("root"))}},[[215,1,2]]]);
//# sourceMappingURL=main.fa25c3f8.chunk.js.map